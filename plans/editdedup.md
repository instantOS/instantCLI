edit and setup might have a lot in common, make sure there isn't duplicate code
between them and extract utility functions if appropriate (or make other changes
improving the quality)
